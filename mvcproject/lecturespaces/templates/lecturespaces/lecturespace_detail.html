{% extends "base.html" %}
{% load youtube_tags %}

{% block content %}
    <h1>{{ lecturespace.title }}</h1>
    <p><strong>Created by:</strong> {{ lecturespace.created_by.username }}</p>
    <p><strong>Created at:</strong> {{ lecturespace.created_at }}</p>
    <p><strong>YouTube URL:</strong> <a href="{{ lecturespace.youtube_url }}">{{ lecturespace.youtube_url }}</a></p>

    {% if lecturespace.youtube_url %}
    {% extract_id lecturespace.youtube_url as video_id %}
    {% if video_id %}
    <iframe width="560" height="315" src="https://www.youtube.com/embed/{{ video_id }}" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen></iframe>
    {% endif %}
    {% endif %}

    <p><strong>Tags:</strong>
        {% for tag in lecturespace.tags.all %}
        {{ tag.name }}
        {% if not forloop.last %}, {% endif %}
        {% endfor %}
    </p>

    <!-- Lecture Space Form -->
    <form action="{% url 'save_lecturespace' lecturespace.id %}" method="post">
        {% csrf_token %}
        <button type="submit">Save Lecturespace</button>
    </form>

    <!-- Flashcard Creation Form -->
    <form id="flashcard-form" action="{% url 'create_flashcard' lecturespace.id %}" method="post">
        {% csrf_token %}
        <button type="submit">Create Flashcard</button>
    </form>

    <h2>Flashcards</h2>
    <ul>
        {% for flashcard in lecturespace.flashcards.all %}
        <li class="flashcard-container">
            <form action="{% url 'save_flashcard' flashcard.id %}" method="post">
                {% csrf_token %}
                <button type="submit">Save Flashcard</button>
            </form>
            <h3>{{ flashcard.title }}</h3>
            <p>{{ flashcard.content }}</p>
            <p>Likes: {{ flashcard.likes }}, Dislikes: {{ flashcard.dislikes }}</p>
            <!-- Like/Dislike Forms -->
            <form action="{% url 'like_flashcard' flashcard.id %}" method="post">
                {% csrf_token %}
                <button type="submit">Like</button>
            </form>
            <form action="{% url 'dislike_flashcard' flashcard.id %}" method="post">
                {% csrf_token %}
                <button type="submit">Dislike</button>
            </form>
        </li>
        {% empty %}
        <li>No flashcards available.</li>
        {% endfor %}
    </ul>

    <!-- Flashcard Creation Modal -->
    <div id="flashcardCreationModal" class="modal">
        <div class="modal-content">
            <p>Creating flashcard, please wait...</p>
        </div>
    </div>

    <script>
        document.getElementById('flashcard-form').onsubmit = function () {
            document.getElementById('flashcardCreationModal').style.display = 'block';
        };
    </script>
{% endblock %}
